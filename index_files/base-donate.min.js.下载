const oneTimeButton = document.getElementById('modf-frequency-one-time');
const monthlyButton = document.getElementById('modf-frequency-monthly');
const monthlyTextcontent = document.getElementById('frequency-monthly-text-div');

const labeloneTime = document.getElementById('labeloneTime');
const labelmonthly = document.getElementById('labelmonthly');

const otheramountinput = document.getElementById('customdonationinput');
const customDonationDiv = document.querySelector('.custom-donation');

const dropdownElements1 = document.querySelector('.dropdown-elements');
const nowdropdownEle = document.getElementById('modf-toggle-designations-options');
const selectdropContent = document.getElementById('select-modf-designation');

const payiframebox = document.getElementById('payiframe');

const paymentBtn = document.querySelectorAll('.payment-type');

selectdropContent.addEventListener('click', () => {
    dropdownElements1.classList.remove('hidden');
});

/*dropdownElements1.addEventListener('click', () => {
    const dropdownElementsHasHiddenClass = dropdownElements1.classList.contains('hidden');
    dropdownElements1.classList.add('hidden');
});*/


const modfdesignationDivs = document.querySelectorAll('div[id^="modf-designation-"]');
modfdesignationDivs.forEach((divitem) => {
    divitem.addEventListener('click', () => {
        //input.setAttribute('checked', 'checked');
        dropdownElements1.classList.add('hidden');
        //console.log(divitem.innerHTML);
        selectdropContent.innerHTML = divitem.innerHTML;
    });
});


oneTimeButton.addEventListener('click', () => {
    monthlyTextcontent.style.display = 'none';
    labelmonthly.classList.remove('active');
    labeloneTime.classList.add('active');
    monthlyButton.removeAttribute('checked');
    oneTimeButton.setAttribute('checked', 'checked');
});

monthlyButton.addEventListener('click', () => {
    monthlyTextcontent.style.display = 'block';
    labelmonthly.classList.add('active');
    labeloneTime.classList.remove('active');
    oneTimeButton.removeAttribute('checked');
    oneTimeButton.setAttribute('checked', 'checked');
});


const amountinputs = document.querySelectorAll('input[id^="modf-handle-"]');
const amountdivs = document.querySelectorAll('div[id^="modf-handle-"]');

const donateamountvalue = document.getElementById('donateamountvalue');

const paysrc = 'https://redcross-us.org/payment/square/index.php';

amountinputs.forEach((input) => {
    input.addEventListener('click', () => {
        customDonationDiv.classList.remove('active');
        const clickedInput = event.currentTarget;
        clickedInput.setAttribute('checked', 'checked');
        //parentDiv = input.parentElement;
        //parentDiv.classList.add('active');



        paymentBtn.forEach((payitem) => {
            payitem.classList.remove('disabled');
        });
        
        //payiframebox.src = paysrc + '?amount=' + input.value;
        donateamountvalue.value = input.value.replace("$", "");




        amountdivs.forEach((div) => {
            const divInput = div.querySelector('input');
            if (divInput === clickedInput) {
                // 如果是点击的 input，则为当前 div 元素添加 active 类，并将当前 input 的 checked 属性设置为 true
                div.classList.add('active');
                clickedInput.checked = true;
            } else {
                // 否则，去除当前 div 元素的 active 类，并将当前 input 的 checked 属性设置为 false
                div.classList.remove('active');
                divInput.removeAttribute('checked');
                clickedInput.checked = false;
            }
        });
    });
});



otheramountinput.addEventListener('input', (event) => {

    //const amountinputs = document.querySelectorAll('input[id^="modf-handle-"]');
    amountinputs.forEach((inputitem) => {
        //console.log(inputitem);
        inputitem.removeAttribute('checked');
        inputitem.checked = false;
        parentDiv = inputitem.parentElement;
        parentDiv.classList.remove('active');
    });

    amountdivs.forEach((div) => {
        div.classList.remove('active');
    });

    customDonationDiv.classList.add('active');
    
    
    paymentBtn.forEach((payitem) => {
        payitem.classList.remove('disabled');
    });



    //console.log('Input changed:', event.target.value);

    const regex = /^[1-9][0-9]*$/;
    const value = event.target.value;
    if (regex.test(value)) {
        // 输入的值为正数
        //payiframebox.src = paysrc + '?amount=' + value;
        donateamountvalue.value = value;
    } else {
        // 输入的值不为正数
    }
});

const myModal = document.getElementById('exampleModal');

myModal.addEventListener('shown.bs.modal', () => {
    //payiframebox.src = paysrc + '?amount=' + donateamountvalue.value;
    let paydata = { "amount": donateamountvalue.value };
    let iframeWindow = window.frames[0];
    iframeWindow.postMessage(paydata, "*");
});
